<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="entry.css">
    <title>魔法師學院入口網站</title>

    <!-- 跨HTML遊戲互動與雲端功能，登入按鈕，資料庫 -->
    <script type="module" src="js/firebase.js"></script>

    <script>

        //建立使用者物件及遊戲資料 中介層
        class RPGGameDatas {
            constructor(name) {
                this.RPGname = name;//字串
                this.lastTime = Date.now();
            }
            setRPGData(key, data) {
                if (typeof key === "string") {
                    this[key] = data;
                }
            }
            setRPGDatas(datas) {
                datas.forEach(({ key, data }) => {
                    this.setRPGData(key, data)
                });
            }
        }

        window.user = window.user || {
            id: null,
            displayName: null,
            gamedatas: {},
            setDisplayName(name) {
                if (typeof (name) === "string") {
                    this.displayName = name;
                }
            },
            addRPGDatas(gameName, datas) { //datas=[{},{},...]
                if (typeof gameName === "string" && Array.isArray(datas)) {
                    if (!this.gamedatas.hasOwnProperty(gameName)) {
                        this.gamedatas[gameName] = new RPGGameDatas(gameName);
                        this.gamedatas[gameName].setRPGDatas(datas);
                    } else {
                        this.gamedatas[gameName].setRPGDatas(datas);
                    }
                } else {
                    console.log(Array.isArray(datas))
                    throw new Error("gameName必須是字串且datas=[{key,value},{},...]");
                }

            }
        };
    </script>


</head>

<body>
    <!-- 網頁本體 -->
    <header>
        <h1>歡迎進入魔法師學校</h1>

        <div id="loginArea">
            <button type="button" id="toggleNavBtn">隱藏或顯示按鈕列</button>
            <button type="button" id="loginBtn">登入或註冊</button>
        </div>
    </header>

    <main>
        <nav id="leftsideArea">
            <button id="fisrtBtn" onclick="loadGame('intro.html')">首頁</button>
            <button id="puzzleGame" onclick="loadGame('puzzleGame/puzzleGame.html')">拼圖遊戲</button>
            <button id="test">測試</button>
        </nav>
        
        <section id="fullscreenPart">
            <p id="iframeUpperText"></p>
            <iframe id="gameFrame" src="intro.html" name="intro"></iframe>
            <div id="additionFunction"></div>
        </section>
    </main>

    <!-- 屬於入口網頁而已的程式碼 -->
    <script src="js/index.js"></script>


    <!-- 測試這個模組
    <script type="module">
        import { getFunctions, httpsCallable } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-functions.js";

        const functions = getFunctions();
        const saveGameData = httpsCallable(functions, "saveGameData");

        export async function uploadSave() {
            try {
                const result = await saveGameData({
                    userId: window.user.id,
                    gamedatas: window.user.gamedatas,
                });

                console.log(result.data.message);
            } catch (err) {
                console.error("存檔錯誤:", err.message);
            }
        }
        window.uploadSave = uploadSave();

    </script> -->
</body>

</html>